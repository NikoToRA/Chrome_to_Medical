<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chrome to X</title>
  <link rel="stylesheet" href="sidepanel.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-left">
        <h1>Chrome to X</h1>
        <div class="platform-indicator" id="platformIndicator"></div>
      </div>
      <div class="header-actions">
        <button id="openSettingsBtn" class="header-icon-btn" title="設定を開く" aria-label="設定を開く">
          ⚙️
        </button>
      </div>
    </header>

    <main class="main-content">
      <nav class="tab-bar" role="tablist">
        <button class="tab-button active" data-tab-target="textTab" role="tab" aria-selected="true">テキスト編集</button>
        <button class="tab-button" data-tab-target="aiTab" role="tab" aria-selected="false">AIチャット</button>
      </nav>

      <section class="tab-content active" data-tab="textTab" role="tabpanel" aria-labelledby="textTab">
      <!-- テキスト編集エリア -->
      <section class="text-editor-section">
        <div class="section-header">
          <h2>テキスト編集</h2>
          <div class="char-count" id="charCount">0文字</div>
        </div>
        <div class="text-editor-top-controls">
          <button id="clearAllBtn" class="btn btn-small btn-danger">🗑️ Allクリア</button>
        </div>
        <textarea 
          id="textEditor" 
          class="text-editor" 
          placeholder="テキストを入力してください..."
          rows="8"
        ></textarea>
        <div class="text-editor-controls">
          <button id="clearTextBtn" class="btn btn-small btn-ghost">クリア</button>
        </div>
      </section>

      <!-- ハッシュタグ管理エリア -->
      <section class="hashtag-section">
        <div class="section-header">
          <h2>ハッシュタグ</h2>
          <button id="manageHashtagsBtn" class="btn btn-small">管理</button>
        </div>
        <div id="hashtagList" class="hashtag-list"></div>
      </section>

      <!-- ページに貼り付けるボタン -->
      <section class="action-section">
        <button id="pasteToPageBtn" class="btn btn-primary btn-large">📋 ページに貼り付ける</button>
      </section>

      <!-- 画像追加エリア -->
      <section class="image-section">
        <div class="section-header">
          <h2>画像</h2>
          <span class="image-count" id="imageCount">0枚</span>
        </div>
        <div class="image-controls">
          <button id="captureScreenshotBtn" class="btn btn-primary">📷 画面をSS</button>
          <button id="captureSelectScreenshotBtn" class="btn btn-primary">✂️ 選択SS</button>
          <button id="addImageBtn" class="btn btn-primary">画像を追加</button>
          <input type="file" id="imageInput" accept="image/*" multiple style="display: none;">
        </div>
        <div id="imagePreview" class="image-preview drop-zone"></div>
      </section>
      </section>

      <section class="tab-content" data-tab="aiTab" role="tabpanel" aria-labelledby="aiTab">
        <div class="ai-panel" role="application">
          <div class="ai-chat-wrapper">
            <div class="ai-chat-overlay">
              <div class="ai-agent-select">
                <select id="agentSelector" class="ai-agent-select-input" aria-label="エージェント選択">
                  <option value="" selected>エージェントを選択...</option>
                  <option value="buzz">バズ投稿エージェント</option>
                  <option value="reply">返信サポートエージェント</option>
                  <option value="editor">文章リライトエージェント</option>
                </select>
              </div>
            </div>
            <div id="aiChatMessages" class="ai-chat-messages" aria-live="polite"></div>
          </div>
          <div class="ai-actions">
            <button id="clearChatBtn" class="btn btn-small btn-ghost">チャット履歴をクリア</button>
            <button id="sendAiToTextBtn" class="btn btn-primary btn-send-to-text">➡️ テキストに送る</button>
          </div>
          <form class="ai-chat-input" id="aiChatForm">
            <textarea
              id="aiChatInput"
              class="ai-input"
              rows="3"
              placeholder="Shift+Enterで改行、Enterで送信。"
            ></textarea>
            <button id="aiChatSendBtn" type="submit" class="btn btn-primary">送信</button>
          </form>
        </div>
      </section>
    </main>
  </div>

  <!-- ハッシュタグ管理モーダル -->
  <div id="hashtagModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ハッシュタグ管理</h2>
        <button class="modal-close" id="closeHashtagModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="hashtag-input-group">
          <input type="text" id="newHashtagInput" class="input" placeholder="#ハッシュタグを入力">
          <button id="addHashtagBtn" class="btn btn-primary">追加</button>
        </div>
        <div id="hashtagManageList" class="hashtag-manage-list"></div>
      </div>
    </div>
  </div>

  <script src="/utils/storage.js"></script>
  <script src="/utils/aiAgents.js"></script>
  <script src="/utils/image.js"></script>
  <script src="/utils/detector.js"></script>
  <script src="sidepanel.js"></script>
</body>
</html>
