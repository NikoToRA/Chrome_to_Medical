# サブスクリプション契約・解約フロー確認手順書
作成日: 2025-12-14

本ドキュメントは、Karte AI+ の「新規契約（再契約）」から「解約」までの一連の動作確認手順をまとめたものです。

## 1. 新規契約（または再契約）の確認手順

1.  **LPへアクセス**
    *   [https://stkarteai1763705952.z11.web.core.windows.net/](https://stkarteai1763705952.z11.web.core.windows.net/) にアクセスします。
    *   「無料トライアルを始める」またはヘッダーの「登録」ボタンをクリックします。

2.  **決済情報の入力 (Stripe)**
    *   メールアドレスとカード情報を入力して決済を行います。
    *   **再契約検証のテクニック:**
        *   同じメールアドレスでは再契約できない場合があります。検証用には **Gmailのエイリアス** を使用してください。
        *   例: `yourname+test01@gmail.com` (`+`以降の文字を追加しても、元の `yourname@gmail.com` にメールが届きます)

3.  **トークンの発行確認 (Success Page)**
    *   決済完了後、`Success Page` にリダイレクトされます。
    *   画面に表示された「認証トークン（Magic Link）」をコピーします。
    *   *チェックポイント*: 同時に「【Karte AI+】ご利用開始のお知らせ」というメールが届いていることを確認します。

4.  **拡張機能へのログイン**
    *   Chrome拡張機能を開きます。
    *   コピーしたトークンを入力欄に貼り付け、ログインします。
    *   *チェックポイント*: AIチャット画面が表示され、機能が利用可能になることを確認します。

---

## 2. 本番環境での領収書・課金テスト手順（即時課金・即時返金）

本番カードを使用した検証において、14日間のトライアルを待たずに「今すぐ領収書メールを確認」し、かつ「実質支払いをキャンセル」する手順です。

### 手順1: 強制課金（領収書発行）
1.  上記手順でトライアル登録を完了させます。
2.  **Stripeダッシュボード（本番環境）**を開きます。
3.  「顧客 (Customers)」メニューから、登録したテストユーザーを探してクリックします。
4.  「サブスクリプション」セクションの右側にある「...」メニューをクリックし、**「トライアルを終了 (End trial)」**を選択します。
5.  確認画面で確定すると、**即座に登録カードへの決済が実行され、領収書メールが送信されます**。
6.  *チェックポイント*: メールボックスを確認し、領収書メールが届いていることを確認してください。

### 手順2: 返金処理（コスト負担の回避）
1.  Stripeダッシュボードの「支払い (Payments)」メニューを開きます。
2.  先ほど実行された決済（Succeededと表示されているもの）をクリックします。
3.  画面右上の **「返金 (Refund)」** ボタンをクリックします。
4.  「全額返金」を選択し、必要であれば理由（「リクエストによる」等）を選んで「返金」を実行します。
5.  *チェックポイント*: 「返金済み」ステータスになったことを確認します。これでカードへの請求は取り消し（または相殺）されます。

---

## 3. 解約動作の確認手順

上記返金テストとは別に、通常のユーザーフローとしての「解約」動作を確認する場合の手順です。
（※返金処理を行うとサブスクリプションもキャンセルされる場合があるため、解約UIの確認を行いたい場合は、返金前に以下の操作を行うか、別途テスト用アカウントで行ってください）

1.  **設定画面を開く**
    *   拡張機能右上の設定アイコン（歯車マーク）をクリックします。

2.  **解約ボタンのクリック**
    *   「サブスクリプション管理」セクションにある「プランを解約する」ボタンをクリックします。
    *   確認ダイアログで「OK」を選択します。

3.  **解約完了の確認 (UI)**
    *   画面右上に「解約予約が完了しました」というトースト通知が表示されます。
    *   ボタンの表示が「解約予約済み (期間終了まで利用可)」に変化し、グレーアウト（無効化）されます。
    *   ボタンの下に赤文字で「※ 202X/XX/XX までご利用いただけます...」と終了日が表示されます。

4.  **解約完了の確認 (メール)**
    *   登録メールアドレスを確認します。
    *   *チェックポイント*: 「【Karte AI+】解約完了のお知らせ」という件名のメールが届いていることを確認します。

5.  **ステータスの再確認 (リロード)**
    *   拡張機能の設定画面を一度閉じ、再度開きます。
    *   ボタンが「プランを解約する」に戻っておらず、「解約予約済み...」のまま維持されていることを確認します。

---

## 4. 期間終了後の挙動（参考）

*   記載された期間終了日を過ぎると、Azure側のバッチ処理（または次回のログイン時チェック）により、ステータスが `inactive`（利用不可）に切り替わります。
*   その際、拡張機能上では自動的にログアウト、または機能制限がかかります。

以上
