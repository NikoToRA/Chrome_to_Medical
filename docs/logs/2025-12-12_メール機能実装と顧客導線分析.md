# é–‹ç™ºãƒ­ã‚°: ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½å®Ÿè£…ã¨é¡§å®¢å°ç·šåˆ†æ

**æ—¥ä»˜**: 2025-12-12
**ä½œæ¥­æ™‚é–“**: ç´„4æ™‚é–“
**æ‹…å½“**: Claude Code (Sonnet 4.5)

---

## ğŸ“‹ ä½œæ¥­ã‚µãƒãƒªãƒ¼

### å®Ÿæ–½ã—ãŸä½œæ¥­
1. ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ä¿®æ­£
2. é ˜åæ›¸PDFã¸ã®é¡§å®¢æƒ…å ±ï¼ˆä½æ‰€ãƒ»æ‹…å½“è€…ï¼‰è¿½åŠ 
3. PDFç”Ÿæˆæ™‚ã®ãƒ•ã‚©ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ä¿®æ­£
4. Stripe Webhookçµ±åˆãƒ†ã‚¹ãƒˆ
5. é¡§å®¢å°ç·šã®è©³ç´°åˆ†æ
6. æœ¬ç•ªé‹ç”¨å‰ã®å¿…é ˆæ©Ÿèƒ½ã®ç‰¹å®š

---

## ğŸ”§ å®Ÿè£…å†…å®¹

### 1. ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ä¿®æ­£

**å•é¡Œ**:
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ãŒãƒ¡ãƒ¼ãƒ«ã«è¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **:
- `generatePortalUrl`é–¢æ•°ã§HTTP fetchã‚’ä½¿ç”¨ã—ã¦ã„ãŸãŒã€Stripe APIã‚­ãƒ¼ã®è¨­å®šãƒŸã‚¹ã§ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ãŸ
- ã‚¨ãƒ©ãƒ¼æ™‚ã«nullã‚’è¿”ã™ãŸã‚ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ãŒç”Ÿæˆã•ã‚Œãªã‹ã£ãŸ

**ä¿®æ­£å†…å®¹**:
```javascript
// azure-functions/utils/email.js

// ä¿®æ­£å‰: HTTP fetchã§è‡ªåˆ†è‡ªèº«ã®APIã‚’å‘¼ã³å‡ºã—
async generatePortalUrl(email) {
    const response = await fetch(`${functionUrl}/api/create-portal-session`, {...});
    // ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ãŸ
}

// ä¿®æ­£å¾Œ: Stripeãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç›´æ¥ä½¿ç”¨
async generatePortalUrl(email) {
    const subscription = await getSubscription(email);
    const session = await stripe.billingPortal.sessions.create({
        customer: subscription.stripeCustomerId,
        return_url: process.env.CANCEL_PAGE_URL
    });
    return session.url;
}
```

**ãƒ†ã‚¹ãƒˆçµæœ**:
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆæˆåŠŸ
- âœ… Azure Functionsæœ¬ç•ªç’°å¢ƒãƒ†ã‚¹ãƒˆæˆåŠŸ
- âœ… Stripeã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ãŒãƒ¡ãƒ¼ãƒ«ã«å«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

---

### 2. é ˜åæ›¸PDFã¸ã®é¡§å®¢æƒ…å ±è¿½åŠ 

**è¦ä»¶**:
- é¡§å®¢ã®ä½æ‰€ã€æ–½è¨­åã€é›»è©±ç•ªå·ã‚’PDFã«è¡¨ç¤º

**å®Ÿè£…å ´æ‰€**:
1. `azure-functions/stripe-webhook/index.js` - Usersãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¡§å®¢æƒ…å ±ã‚’å–å¾—
2. `azure-functions/utils/receipt.js` - PDFã«æƒ…å ±ã‚’è¿½åŠ è¡¨ç¤º

**ä¿®æ­£å†…å®¹**:
```javascript
// stripe-webhook/index.js
const userInfo = await getUser(customerEmail);

const buffer = await receiptGenerator.generateReceipt({
    receiptNumber,
    customerName: userInfo?.name || invoice.customer_name,
    customerEmail: customerEmail,
    customerAddress: userInfo?.address,      // æ–°è¦è¿½åŠ 
    customerPhone: userInfo?.phone,          // æ–°è¦è¿½åŠ 
    facilityName: userInfo?.facilityName,    // æ–°è¦è¿½åŠ 
    amount: amount,
    billingDate: billingDate,
    issueDate: new Date()
});
```

```javascript
// utils/receipt.js
// Customer Information
doc.fontSize(12)
   .text('ãŠå®¢æ§˜æƒ…å ±', { underline: true })
   .moveDown(0.5);

if (receiptData.facilityName) {
   doc.text(`æ–½è¨­å: ${receiptData.facilityName}`);
}

doc.text(`ãŠåå‰: ${receiptData.customerName}`);

if (receiptData.customerAddress) {
   doc.text(`ã”ä½æ‰€: ${receiptData.customerAddress}`);
}

if (receiptData.customerPhone) {
   doc.text(`é›»è©±ç•ªå·: ${receiptData.customerPhone}`);
}

doc.text(`ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: ${receiptData.customerEmail}`)
   .moveDown();
```

**ãƒ†ã‚¹ãƒˆçµæœ**:
- âœ… Usersãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¡§å®¢æƒ…å ±ã‚’æ­£å¸¸ã«å–å¾—
- âœ… PDFã«æ–½è¨­åã€ä½æ‰€ã€é›»è©±ç•ªå·ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
- âœ… æƒ…å ±ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯éè¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«å¯¾å¿œï¼‰

---

### 3. PDFç”Ÿæˆæ™‚ã®ãƒ•ã‚©ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ä¿®æ­£

**å•é¡Œ**:
- é ˜åæ›¸PDFç”Ÿæˆæ™‚ã«ã€ŒUnknown font formatã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
- ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå¤±æ•—

**åŸå› **:
- ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`NotoSansJP-Regular.ttf`ï¼‰ãŒå®Ÿéš›ã«ã¯HTMLãƒ•ã‚¡ã‚¤ãƒ«ã ã£ãŸ
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼ã§ç ´æã—ã¦ã„ãŸ

**ä¿®æ­£å†…å®¹**:
```bash
# æ­£ã—ã„ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
curl -L "https://github.com/google/fonts/raw/main/ofl/notosansjp/NotoSansJP%5Bwght%5D.ttf" \
  -o azure-functions/assets/fonts/NotoSansJP-Regular.ttf

# çµæœ: 9.1MB TrueTypeãƒ•ã‚©ãƒ³ãƒˆ
```

```javascript
// utils/receipt.js - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¿½åŠ 
try {
    const fontPath = path.join(__dirname, '../assets/fonts/NotoSansJP-Regular.ttf');
    if (fs.existsSync(fontPath)) {
        doc.font(fontPath);
        console.log('[Receipt] Using Japanese font');
    } else {
        console.warn('[Receipt] Japanese font not found, using default font');
        doc.font('Helvetica');
    }
} catch (fontError) {
    console.error('[Receipt] Error loading font, using default:', fontError.message);
    doc.font('Helvetica');
}
```

**ãƒ†ã‚¹ãƒˆçµæœ**:
- âœ… æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã§æ­£å¸¸ã«PDFç”Ÿæˆ
- âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚‚å‹•ä½œç¢ºèª
- âœ… ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿæ–½å†…å®¹

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
```bash
node send_test_emails_manual.js
```

**çµæœ**:
- âœ… ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸï¼ˆMessageId: 8796d9ef-7a26-46ee-9687-294677af042fï¼‰
- âœ… é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸï¼ˆMessageId: f3f3f1f8-c793-402c-aaa6-6cf16593302fï¼‰
- âœ… ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ç”ŸæˆæˆåŠŸ
- âœ… PDFç”ŸæˆæˆåŠŸï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆä½¿ç”¨ï¼‰

### Azure Functionsæœ¬ç•ªç’°å¢ƒãƒ†ã‚¹ãƒˆ
```bash
# Stripe CLIã§Webhookã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰
stripe listen --forward-to https://func-karte-ai-1763705952.azurewebsites.net/api/stripe-webhook

# invoice.payment_succeededã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
stripe trigger invoice.payment_succeeded --override customer:email=super206cc@gmail.com
```

**çµæœ**:
- âœ… ã™ã¹ã¦ã®Webhookã‚¤ãƒ™ãƒ³ãƒˆãŒ200 OKã§å‡¦ç†
- âœ… `invoice.payment_succeeded`ã‚¤ãƒ™ãƒ³ãƒˆæ­£å¸¸å‡¦ç†
- âœ… é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸï¼ˆé¡§å®¢æƒ…å ±ä»˜ãPDFï¼‰

---

## ğŸ“Š é¡§å®¢å°ç·šåˆ†æçµæœ

### å®Ÿè£…æ¸ˆã¿ã®å°ç·š
1. **æ–°è¦ç™»éŒ²**
   - Magic Linkèªè¨¼ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å…¥åŠ› â†’ Stripe Checkout â†’ ãƒˆãƒ©ã‚¤ã‚¢ãƒ«é–‹å§‹

2. **ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“**
   - 10æ—¥ç›®ï¼šè­¦å‘Šãƒ¡ãƒ¼ãƒ«ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ä»˜ãï¼‰âœ…
   - 14æ—¥ç›®ï¼šè‡ªå‹•èª²é‡‘

3. **ç¶™ç¶šåˆ©ç”¨**
   - æ¯æœˆã®èª²é‡‘ â†’ é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«é€ä¿¡ âœ…

4. **è§£ç´„**
   - Stripe Customer Portal â†’ ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Ÿè¡Œ â†’ Webhookå‡¦ç†

### âŒ ä¸è¶³ã—ã¦ã„ã‚‹é‡è¦æ©Ÿèƒ½

#### ğŸ”´ æœ€å„ªå…ˆï¼ˆæœ¬ç•ªé‹ç”¨å‰ã«å¿…é ˆï¼‰
1. **ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«**ï¼ˆç™»éŒ²å®Œäº†æ™‚ï¼‰
   - ãƒˆãƒ©ã‚¤ã‚¢ãƒ«æœŸé–“ã®èª¬æ˜
   - æ©Ÿèƒ½ç´¹ä»‹
   - ã‚µãƒãƒ¼ãƒˆé€£çµ¡å…ˆ

2. **ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Œäº†ãƒ¡ãƒ¼ãƒ«**
   - ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç¢ºèª
   - ã‚¢ã‚¯ã‚»ã‚¹çµ‚äº†æ—¥
   - å†ç™»éŒ²æ¡ˆå†…

3. **æ±ºæ¸ˆå¤±æ•—æ™‚ã®å¯¾å¿œ**
   - `invoice.payment_failed`ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†
   - ã‚«ãƒ¼ãƒ‰æƒ…å ±æ›´æ–°ãƒªãƒ³ã‚¯
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåœæ­¢ã¾ã§ã®çŒ¶äºˆæœŸé–“

4. **è§£ç´„å¾Œã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡**
   - Chromeæ‹¡å¼µæ©Ÿèƒ½å´ã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯
   - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã®ç¢ºèª
   - æœŸé™åˆ‡ã‚Œæ™‚ã®æ©Ÿèƒ½ç„¡åŠ¹åŒ–

#### ğŸŸ¡ é‡è¦ï¼ˆé‹ç”¨é–‹å§‹å¾Œã™ãã«å®Ÿè£…ï¼‰
5. **æœ‰æ–™ãƒ—ãƒ©ãƒ³ç§»è¡Œé€šçŸ¥ãƒ¡ãƒ¼ãƒ«**
   - ãƒˆãƒ©ã‚¤ã‚¢ãƒ«çµ‚äº†ãƒ»èª²é‡‘é–‹å§‹ã®é€šçŸ¥

6. **Customer Portalã¸ã®ã‚¢ã‚¯ã‚»ã‚¹å°ç·š**
   - Chromeæ‹¡å¼µæ©Ÿèƒ½å†…ã«ãƒªãƒ³ã‚¯
   - ã‚«ãƒ¼ãƒ‰æƒ…å ±æ›´æ–°ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒç°¡å˜ã«

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤å±¥æ­´

### ã‚³ãƒŸãƒƒãƒˆ1: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ã®ä¿®æ­£
```
git commit -m "fix: ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«ã¨é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã®ä¿®æ­£"
- ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ç”Ÿæˆã‚’Stripe APIã§ç›´æ¥å®Ÿè¡Œ
- é ˜åæ›¸PDFç”Ÿæˆã®ãƒ•ã‚©ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ã‚’ä¿®æ­£
- æ­£ã—ã„Noto Sans JPãƒ•ã‚©ãƒ³ãƒˆï¼ˆTrueTypeï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```

### ã‚³ãƒŸãƒƒãƒˆ2: é¡§å®¢æƒ…å ±ã®è¿½åŠ 
```
git commit -m "feat: é ˜åæ›¸PDFã«é¡§å®¢æƒ…å ±ï¼ˆä½æ‰€ãƒ»æ‹…å½“è€…ï¼‰ã‚’è¿½åŠ "
- stripe-webhook: invoice.payment_succeededæ™‚ã«Usersãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰é¡§å®¢æƒ…å ±ã‚’å–å¾—
- receipt.js: æ–½è¨­åã€ä½æ‰€ã€é›»è©±ç•ªå·ã‚’PDFã«è¿½åŠ è¡¨ç¤º
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰
```bash
cd azure-functions
func azure functionapp publish func-karte-ai-1763705952
```

---

## ğŸ“ å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«
- `azure-functions/utils/email.js` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ç”Ÿæˆã‚’ä¿®æ­£
- `azure-functions/utils/receipt.js` - ãƒ•ã‚©ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼å¯¾å¿œã€é¡§å®¢æƒ…å ±è¿½åŠ 
- `azure-functions/stripe-webhook/index.js` - é¡§å®¢æƒ…å ±å–å¾—å‡¦ç†è¿½åŠ 
- `azure-functions/local.settings.json` - Stripe APIã‚­ãƒ¼æ›´æ–°

### æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«
- `azure-functions/assets/fonts/NotoSansJP-Regular.ttf` - æ­£ã—ã„æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆï¼ˆ9.1MBï¼‰
- `azure-functions/send_test_emails_manual.js` - ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

---

## âš ï¸ æ³¨æ„äº‹é …ãƒ»æ—¢çŸ¥ã®å•é¡Œ

### Stripe Webhook Secret
- Azure Portal ã®ç’°å¢ƒå¤‰æ•° `STRIPE_WEBHOOK_SECRET` ã«è¨­å®šæ¸ˆã¿
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã—ãªã„ã“ã¨

### ç’°å¢ƒå¤‰æ•°
- `ALLOW_FAKE_EMAIL_SUCCESS=false`ï¼ˆ2026-01-26ä¿®æ­£æ¸ˆã¿ï¼‰
- `RETURN_MAGIC_LINK=false`ï¼ˆ2026-01-26ä¿®æ­£æ¸ˆã¿ï¼‰

### Webhookæœªå¯¾å¿œã‚¤ãƒ™ãƒ³ãƒˆ
- `invoice.payment_failed` - å®Ÿè£…ã•ã‚Œã¦ã„ãªã„ï¼ˆå¿…é ˆï¼‰
- `customer.subscription.deleted` - ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—ï¼ˆå¿…é ˆï¼‰

---

## ğŸ“ æ¬¡å›ä½œæ¥­äºˆå®š

### 2025-12-12ï¼ˆæ˜æ—¥ï¼‰é–‹å§‹äºˆå®š
1. ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«å®Ÿè£…
2. ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Œäº†ãƒ¡ãƒ¼ãƒ«å®Ÿè£…
3. æ±ºæ¸ˆå¤±æ•—æ™‚ã®å¯¾å¿œå®Ÿè£…
4. è§£ç´„å¾Œã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡å®Ÿè£…

è©³ç´°ã¯ `docs/Todo/2025-12-12_æœ¬ç•ªé‹ç”¨å‰ã®å¿…é ˆæ©Ÿèƒ½å®Ÿè£….md` ã‚’å‚ç…§ã€‚

---

## ğŸ¯ æˆæœç‰©

### ãƒ¡ãƒ¼ãƒ«æ©Ÿèƒ½
- âœ… ãƒˆãƒ©ã‚¤ã‚¢ãƒ«è­¦å‘Šãƒ¡ãƒ¼ãƒ«ï¼ˆ10æ—¥ç›®ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒªãƒ³ã‚¯ä»˜ãï¼‰
- âœ… é ˜åæ›¸ãƒ¡ãƒ¼ãƒ«ï¼ˆé¡§å®¢æƒ…å ±ä»˜ãPDFï¼‰
- âŒ ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰
- âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Œäº†ãƒ¡ãƒ¼ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰
- âŒ æ±ºæ¸ˆå¤±æ•—ãƒ¡ãƒ¼ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰
- âŒ æœ‰æ–™ãƒ—ãƒ©ãƒ³ç§»è¡Œãƒ¡ãƒ¼ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰

### Webhookå‡¦ç†
- âœ… `checkout.session.completed` - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆ
- âœ… `customer.subscription.updated` - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æ›´æ–°
- âœ… `customer.subscription.deleted` - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å‰Šé™¤ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ãªã—ï¼‰
- âœ… `invoice.payment_succeeded` - é ˜åæ›¸é€ä¿¡
- âŒ `invoice.payment_failed` - æœªå®Ÿè£…

### ãã®ä»–
- âœ… PDFç”Ÿæˆï¼ˆæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆå¯¾å¿œï¼‰
- âœ… é¡§å®¢æƒ…å ±ã®å–å¾—ãƒ»è¡¨ç¤º
- âœ… Stripe Customer Portalçµ±åˆ
- âŒ Chromeæ‹¡å¼µæ©Ÿèƒ½ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆæœªå®Ÿè£…ï¼‰

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆæƒ…å ±

### Azure Functions
- URL: `https://func-karte-ai-1763705952.azurewebsites.net`
- Resource Group: `rg-karte-ai`
- Location: Japan East

### Stripe
- ãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰: æœ‰åŠ¹
- Webhook URL: `https://func-karte-ai-1763705952.azurewebsites.net/api/stripe-webhook`

### Azure Communication Services
- Sender: `DoNotReply@56e74c6e-f57a-4dfe-9bfc-b6a2157f6e40.azurecomm.net`

---

**ãƒ­ã‚°ä½œæˆæ—¥æ™‚**: 2025-12-12 23:40
**æœ€çµ‚ãƒ†ã‚¹ãƒˆæ—¥æ™‚**: 2025-12-12 23:35
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ãƒ†ã‚¹ãƒˆå®Œäº†ãƒ»æœ¬ç•ªé‹ç”¨å¾…æ©Ÿ
