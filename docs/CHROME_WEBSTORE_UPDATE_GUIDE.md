# Chrome Web Store 拡張機能更新ガイド

## 更新の基本手順

### Step 1: バージョン番号の更新

`extensions/manifest.json` の `version` フィールドを更新します。

```json
{
  "manifest_version": 3,
  "name": "Karte AI+",
  "version": "0.1.1",  // ← ここを更新（例: 0.1.0 → 0.1.1）
  ...
}
```

#### バージョン番号の規則
- **メジャーバージョン** (例: 1.0.0 → 2.0.0): 大きな変更、後方互換性のない変更
- **マイナーバージョン** (例: 0.1.0 → 0.2.0): 新機能追加、後方互換性のある変更
- **パッチバージョン** (例: 0.1.0 → 0.1.1): バグ修正、小さな変更

### Step 2: 変更内容の確認

更新前に以下を確認：
- [ ] 変更したファイルのリスト
- [ ] 新機能の動作確認
- [ ] 既存機能への影響確認
- [ ] エラーハンドリングの確認

### Step 3: 拡張機能のパッケージング

```bash
cd /Users/suguruhirayama/Chrome_to_Medical/extensions
zip -r ../karte-ai-plus-v0.1.1.zip . -x "*.DS_Store" "*.git*" "*.md"
```

**推奨**: バージョン番号を含むファイル名を使用（例: `karte-ai-plus-v0.1.1.zip`）

### Step 4: Chrome Web Store Developer Dashboard で更新

1. **Chrome Web Store Developer Dashboard にアクセス**
   - https://chrome.google.com/webstore/devconsole
   - ログイン

2. **拡張機能を選択**
   - 公開済みの拡張機能をクリック

3. **新しいパッケージをアップロード**
   - 「パッケージ」セクションで「新しいパッケージをアップロード」をクリック
   - 作成したZIPファイルをアップロード

4. **変更内容を入力**
   - 「変更内容」セクションに更新内容を記載
   - 例:
     ```
     - バグ修正: AIチャットのエラーハンドリングを改善
     - 新機能: 定型文のカテゴリ機能を追加
     - UI改善: サイドパネルのレイアウトを調整
     ```

5. **審査を提出**
   - 「変更を保存」をクリック
   - 「審査を提出」をクリック

### Step 5: 審査待ち

- 通常、審査には **1-3営業日** かかります
- 審査中は「審査中」ステータスが表示されます
- 審査が完了すると、自動的にユーザーに更新が配信されます

## 更新の種類と対応

### 1. 通常の更新（機能追加・バグ修正）

**手順**: 上記の基本手順に従う

**注意点**:
- バージョン番号を必ず更新
- 変更内容を明確に記載
- テストを十分に行う

### 2. 緊急のバグ修正

**手順**: 
1. バージョン番号を更新（パッチバージョンを上げる）
2. ZIPファイルを作成
3. Chrome Web Store Developer Dashboard で「優先審査をリクエスト」を選択（有料の場合あり）

**注意点**:
- 緊急修正の理由を明確に記載
- 影響範囲を最小限に抑える

### 3. 権限の追加

**手順**:
1. `manifest.json` の `permissions` または `host_permissions` を更新
2. バージョン番号を更新
3. 通常の更新手順に従う

**注意点**:
- 権限追加の理由を明確に記載
- ユーザーに通知されるため、説明が必要

### 4. プライバシーポリシーの変更

**手順**:
1. プライバシーポリシーページを更新
2. Chrome Web Store Developer Dashboard でプライバシーポリシーURLを更新
3. 必要に応じて拡張機能のバージョンも更新

## 更新前のチェックリスト

### 技術的な確認
- [ ] `manifest.json` のバージョン番号を更新
- [ ] すべてのファイルが正しく含まれているか確認
- [ ] 不要なファイル（.DS_Store、.git など）が含まれていないか確認
- [ ] エラーハンドリングが適切か確認

### 機能的な確認
- [ ] 新機能が正しく動作するか確認
- [ ] 既存機能が壊れていないか確認
- [ ] エッジケースのテスト
- [ ] パフォーマンスの確認

### ドキュメントの確認
- [ ] 変更内容を明確に記載
- [ ] プライバシーポリシーが最新か確認（必要な場合）
- [ ] 利用規約が最新か確認（必要な場合）

## よくある問題と対処法

### 問題1: 審査が却下される

**原因**:
- プライバシーポリシーが不十分
- 権限の説明が不十分
- 機能が説明と異なる

**対処法**:
- 却下理由を確認
- 必要な情報を追加
- 再提出

### 問題2: 更新が反映されない

**原因**:
- キャッシュの問題
- バージョン番号が更新されていない

**対処法**:
- ブラウザのキャッシュをクリア
- `manifest.json` のバージョン番号を確認

### 問題3: ユーザーに更新が配信されない

**原因**:
- 審査がまだ完了していない
- 段階的ロールアウトが設定されている

**対処法**:
- 審査ステータスを確認
- 段階的ロールアウトの設定を確認

## 更新履歴の管理

### 推奨: 更新履歴ファイルを作成

`extensions/CHANGELOG.md` を作成して、更新履歴を管理：

```markdown
# 更新履歴

## [0.1.1] - 2025-01-XX
### 修正
- AIチャットのエラーハンドリングを改善
- トークン入力UIの改善

## [0.1.0] - 2025-01-XX
### 初回リリース
- AIチャット機能
- 定型文管理機能
- トークン認証機能
```

## 自動化スクリプト（オプション）

更新作業を自動化するスクリプト：

```bash
#!/bin/bash
# update-extension.sh

VERSION=$1
if [ -z "$VERSION" ]; then
  echo "使用方法: ./update-extension.sh 0.1.1"
  exit 1
fi

# manifest.jsonのバージョンを更新
sed -i '' "s/\"version\": \".*\"/\"version\": \"$VERSION\"/" extensions/manifest.json

# ZIPファイルを作成
cd extensions
zip -r ../karte-ai-plus-v${VERSION}.zip . -x "*.DS_Store" "*.git*" "*.md"
cd ..

echo "✅ バージョン $VERSION のZIPファイルを作成しました: karte-ai-plus-v${VERSION}.zip"
```

使用方法:
```bash
chmod +x update-extension.sh
./update-extension.sh 0.1.1
```

## まとめ

1. **バージョン番号を更新** (`manifest.json`)
2. **ZIPファイルを作成** (バージョン番号を含むファイル名推奨)
3. **Chrome Web Store Developer Dashboard でアップロード**
4. **変更内容を記載**
5. **審査を提出**
6. **審査完了を待つ** (1-3営業日)

**重要**: 更新前に必ずテストを行い、変更内容を明確に記載してください。
